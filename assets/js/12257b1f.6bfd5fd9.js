"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[273],{8519:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>i,metadata:()=>a,toc:()=>d});var r=n(5893),c=n(1151),o=n(6562);const i={title:"Add Contracts to the Test Suite",sidebar_label:"Add Contracts to the Test Suite",sidebar_position:4,slug:"/add-contracts"},s="Add Contracts to the Test Suite",a={id:"add-contracts",title:"Add Contracts to the Test Suite",description:"It's time to add the contracts to the test suite. It might be helpful to give a brief overview of the contracts before adding them to the test suite.",source:"@site/docs/04-add-contracts.md",sourceDirName:".",slug:"/add-contracts",permalink:"/go-codegen/tutorial/add-contracts",draft:!1,unlisted:!1,editUrl:"https://github.com/srdtrk/go-codegen/tree/main/docs/docs/04-add-contracts.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"Add Contracts to the Test Suite",sidebar_label:"Add Contracts to the Test Suite",sidebar_position:4,slug:"/add-contracts"},sidebar:"docsSidebar",previous:{title:"Scaffold a Test Suite",permalink:"/go-codegen/tutorial/scaffold-suite"},next:{title:"Custom Tests",permalink:"/go-codegen/tutorial/custom-tests"}},l={},d=[{value:"Overview of <code>cw-ica-controller</code>",id:"overview-of-cw-ica-controller",level:2},{value:"Add the Contracts",id:"add-the-contracts",level:2}];function h(t){const e={a:"a",code:"code",h1:"h1",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.a)(),...t.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h1,{id:"add-contracts-to-the-test-suite",children:"Add Contracts to the Test Suite"}),"\n",(0,r.jsx)(e.p,{children:"It's time to add the contracts to the test suite. It might be helpful to give a brief overview of the contracts before adding them to the test suite."}),"\n",(0,r.jsxs)(e.h2,{id:"overview-of-cw-ica-controller",children:["Overview of ",(0,r.jsx)(e.code,{children:"cw-ica-controller"})]}),"\n",(0,r.jsxs)(e.p,{children:["CosmWasm Interchain Account Controller is a pure CosmWasm implementation of the ",(0,r.jsx)(e.a,{href:"https://github.com/cosmos/ibc/tree/main/spec/app/ics-027-interchain-accounts",children:"ICS-27 controller specifications"}),". It can therefore directly create and control accounts in the counterparty ",(0,r.jsx)(e.code,{children:"icahost"})," module."]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://raw.githubusercontent.com/srdtrk/cw-ica-controller/main/docs/static/img/cw-ica-controller.svg",alt:"cw-ica-controller"})}),"\n",(0,r.jsxs)(e.p,{children:["This contract was designed to be instantiated by other contracts that wish to control accounts in a counterparty chain. Learn more about the contract in its repository: ",(0,r.jsx)(e.a,{href:"https://github.com/srdtrk/cw-ica-controller",children:"srdtrk/cw-ica-controller"}),"."]}),"\n",(0,r.jsxs)(o.Z,{type:"note",title:"Note",children:[(0,r.jsx)(e.p,{children:"There are a couple important things to note about this contract:"}),(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Since this contract was designed to be instantiated by other contracts, it does have the capability to make callbacks to an external contract on channel and packet lifecycle events. This is what the ",(0,r.jsx)(e.code,{children:"callback-counter"})," test contract is for."]}),"\n"]}),(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",metastring:"reference",children:"https://github.com/srdtrk/cw-ica-controller/blob/d6b033092071e37f2dd015b58810a02257a92b6b/src/types/callbacks.rs#L15-L46\n"})}),(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"This contract automatically initiates the channel opening handshake when it is instantiated and doesn't allow any relayers to initiate the handshake."}),"\n"]}),(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-rust",metastring:"reference",children:"https://github.com/srdtrk/cw-ica-controller/blob/d6b033092071e37f2dd015b58810a02257a92b6b/src/types/msg.rs#L8-L21\n"})})]}),"\n",(0,r.jsx)(e.h2,{id:"add-the-contracts",children:"Add the Contracts"}),"\n",(0,r.jsxs)(e.p,{children:["In this test, we will only add the ",(0,r.jsx)(e.code,{children:"cw-ica-controller"})," and ",(0,r.jsx)(e.code,{children:"callback-counter"})," contracts to the test suite. To add the ",(0,r.jsx)(e.code,{children:"cw-ica-controller"})," contract to the test suite, run the following command from the root of the workshop repository:"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sh",children:"go-codegen interchaintest add-contract schema/cw-ica-controller.json --suite-dir e2e/interchaintestv8\n"})}),"\n",(0,r.jsx)(e.p,{children:"This command will generate the following files:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-text",children:"e2e/interchaintestv8/\n\u251c\u2500\u2500 contract_test.go\n\u2514\u2500\u2500 types\n    \u2514\u2500\u2500 cwicacontroller\n        \u251c\u2500\u2500 contract.go\n        \u251c\u2500\u2500 msgs.go\n        \u2514\u2500\u2500 query.go\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"contract_test.go"})," contains an example test case for instantiating the generated contract. This file is only generated if it doesn't already exist in the test suite when the ",(0,r.jsx)(e.code,{children:"add-contract"})," command is run."]}),"\n",(0,r.jsxs)(e.p,{children:["You can also add the ",(0,r.jsx)(e.code,{children:"callback-counter"})," contract to the test suite by running the following command:"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sh",children:"go-codegen interchaintest add-contract testing/contracts/callback-counter/schema/callback-counter.json --suite-dir e2e/interchaintestv8\n"})}),"\n",(0,r.jsx)(e.p,{children:"This command will generate the following files:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-text",children:"e2e/interchaintestv8/types/callbackcounter\n\u251c\u2500\u2500 contract.go\n\u251c\u2500\u2500 msgs.go\n\u2514\u2500\u2500 query.go\n"})}),"\n",(0,r.jsxs)(e.p,{children:["This will not modify the ",(0,r.jsx)(e.code,{children:"contract_test.go"})," and the"]}),"\n",(0,r.jsxs)(o.Z,{type:"tip",title:"Exploration",children:[(0,r.jsx)(e.p,{children:"Explore the generated files to understand how the contracts are added to the test suite."}),(0,r.jsx)(e.p,{children:"Run the generated test and understand why it fails."}),(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-sh",children:"cd e2e/interchaintestv8\ngo test -v . -run=TestWithContractTestSuite/TestContract\n"})})]}),"\n",(0,r.jsxs)(o.Z,{type:"warn",title:"Github Actions",children:[(0,r.jsxs)(e.p,{children:["Github Actions will not run the test in the generated ",(0,r.jsx)(e.code,{children:"contract_test.go"})," file. To do this, you need to add the test to the ",(0,r.jsx)(e.code,{children:".github/workflows/e2e.yml"})," file. Moreover, when running the generated test in Github Actions, you will need to build all the contracts before running the test."]}),(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",metastring:'title=".github/workflows/e2e.yml"',children:'# ...\n  build:\n    strategy:\n      fail-fast: false\n      matrix:\n        test:\n          # List your tests here\n          - TestWithBasicTestSuite/TestBasic\n          # plus-diff-line\n+         - TestWithContractTestSuite/TestContract\n    name: ${{ matrix.test }}\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout sources\n        uses: actions/checkout@v3\n      // minus-diff-start\n-     # You can build your contract here, you can either use docker or a custom cargo script:\n-     # We\'ve provided examples for both below:\n-     # \n-     # - name: Build Contracts with Docker\n-     #   run: |\n-     #     docker run --rm -v "$(pwd)":/code \\\n-     #     --mount type=volume,source="$(basename "$(pwd)")_cache",target=/code/target \\\n-     #     --mount type=volume,source=registry_cache,target=/usr/local/cargo/registry \\\n-     #     cosmwasm/optimizer:0.15.1\n-     # - name: Install cargo-run-script\n-     #   uses: actions-rs/cargo@v1\n-     #   with:\n-     #     command: install\n-     #     args: cargo-run-script\n-     # - name: Build Optimized Contract\n-     #   uses: actions-rs/cargo@v1\n-     #   with:\n-     #     command: run-script\n-     #     args: optimize\n      // minus-diff-end\n      // plus-diff-start\n+     - name: Install just\n+       uses: extractions/setup-just@v2\n+     - name: Build Test Contracts with Docker\n+       run: just build-test-contracts\n+     - name: Build Optimized Contract\n+       run: just build-optimize\n      // plus-diff-end\n      - name: Setup Go\n        uses: actions/setup-go@v4\n# ...\n'})})]})]})}function u(t={}){const{wrapper:e}={...(0,c.a)(),...t.components};return e?(0,r.jsx)(e,{...t,children:(0,r.jsx)(h,{...t})}):h(t)}},6562:(t,e,n)=>{n.d(e,{Z:()=>z});var r,c=n(7294);function o(){return o=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},o.apply(this,arguments)}const i=t=>{let{title:e,titleId:n,...i}=t;return c.createElement("svg",o({xmlns:"http://www.w3.org/2000/svg",width:21,height:23,fill:"none",viewBox:"0 0 21 23","aria-labelledby":n},i),e?c.createElement("title",{id:n},e):null,r||(r=c.createElement("path",{fill:"#fff",d:"M9.302 22.2c-.1 0-.3 0-.4-.1-.4-.2-.6-.6-.6-1l.9-6.9h-7.9q-.6 0-.9-.6c-.2-.4-.1-.8.1-1.1l10-12c.3-.3.8-.5 1.2-.3s.6.6.6 1l-.9 6.9h7.9q.6 0 .9.6c.2.4.1.8-.1 1.1l-10 12c-.2.3-.5.4-.8.4m-5.9-10h6.9c.3 0 .6.1.7.3.2.2.3.5.2.8l-.6 4.6 6.4-7.7h-6.9c-.3 0-.6-.1-.7-.3-.2-.2-.3-.5-.2-.8l.6-4.6z"})))};var s;function a(){return a=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},a.apply(this,arguments)}const l=t=>{let{title:e,titleId:n,...r}=t;return c.createElement("svg",a({xmlns:"http://www.w3.org/2000/svg",width:21,height:21,fill:"none",viewBox:"0 0 21 21","aria-labelledby":n},r),e?c.createElement("title",{id:n},e):null,s||(s=c.createElement("path",{fill:"#200F31",d:"M8.3 9.2h-7c-.6 0-1-.4-1-1v-7c0-.6.4-1 1-1h7c.6 0 1 .4 1 1v7c0 .5-.5 1-1 1m-6-2h5v-5h-5zM19.3 9.2h-7c-.6 0-1-.4-1-1v-7c0-.6.4-1 1-1h7c.6 0 1 .4 1 1v7c0 .5-.5 1-1 1m-6-2h5v-5h-5zM19.3 20.2h-7c-.6 0-1-.4-1-1v-7c0-.6.4-1 1-1h7c.6 0 1 .4 1 1v7c0 .5-.5 1-1 1m-6-2h5v-5h-5zM8.3 20.2h-7c-.6 0-1-.4-1-1v-7c0-.6.4-1 1-1h7c.6 0 1 .4 1 1v7c0 .5-.5 1-1 1m-6-2h5v-5h-5z"})))};var d;function h(){return h=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},h.apply(this,arguments)}const u=t=>{let{title:e,titleId:n,...r}=t;return c.createElement("svg",h({xmlns:"http://www.w3.org/2000/svg",width:23,height:23,fill:"none",viewBox:"0 0 23 23","aria-labelledby":n},r),e?c.createElement("title",{id:n},e):null,d||(d=c.createElement("path",{fill:"#fff",d:"M11.3.2C5.2.2.3 5.1.3 11.2s4.9 11 11 11 11-4.9 11-11-4.9-11-11-11m1 19.9v-2.9c0-.6-.4-1-1-1s-1 .4-1 1v2.9c-4.2-.5-7.5-3.8-7.9-7.9h2.9c.6 0 1-.4 1-1s-.4-1-1-1H2.4c.5-4.2 3.8-7.5 7.9-7.9v2.9c0 .6.4 1 1 1s1-.4 1-1V2.3c4.2.5 7.5 3.8 7.9 7.9h-2.9c-.6 0-1 .4-1 1s.4 1 1 1h2.9c-.4 4.2-3.7 7.5-7.9 7.9"})))};var g;function p(){return p=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},p.apply(this,arguments)}const m=t=>{let{title:e,titleId:n,...r}=t;return c.createElement("svg",p({xmlns:"http://www.w3.org/2000/svg",width:23,height:22,fill:"none",viewBox:"0 0 23 22","aria-labelledby":n},r),e?c.createElement("title",{id:n},e):null,g||(g=c.createElement("path",{fill:"#fff",d:"M17.503 21.2c-.2 0-.3 0-.5-.1l-5.7-3-5.7 3c-.3.2-.7.1-1.1-.1-.3-.2-.5-.6-.4-1l1.1-6.4-4.6-4.5c-.3-.3-.4-.7-.3-1 .1-.4.4-.6.8-.7l6.4-.9 2.9-5.8c.3-.7 1.5-.7 1.8 0l2.9 5.8 6.4.9c.4.1.7.3.8.7s0 .8-.3 1l-4.6 4.5 1.1 6.4c.1.4-.1.8-.4 1-.2.1-.4.2-.6.2M3.403 9.1l3.5 3.5c.2.2.3.6.3.9l-.8 4.9 4.4-2.3q.45-.3.9 0l4.4 2.3-.8-4.9c-.1-.3.1-.7.3-.9l3.5-3.5-4.9-.7c-.3 0-.6-.3-.8-.5l-2.2-4.4-2.2 4.4c-.1.3-.4.5-.8.5z"})))};var f;function v(){return v=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},v.apply(this,arguments)}const b=t=>{let{title:e,titleId:n,...r}=t;return c.createElement("svg",v({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",viewBox:"0 0 24 24","aria-labelledby":n},r),e?c.createElement("title",{id:n},e):null,f||(f=c.createElement("path",{stroke:"#fff",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.5 21.2H11m7.7-12.5a6 6 0 0 0-12 0c0 2.3 2.4 4.4 3 5.8 1 1.8 1 3.2 1 3.2h4s0-1.4 1-3.2c.7-1.4 3-3.2 3-5.8"})))};var w;function x(){return x=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},x.apply(this,arguments)}const j=t=>{let{title:e,titleId:n,...r}=t;return c.createElement("svg",x({xmlns:"http://www.w3.org/2000/svg",width:17,height:21,fill:"none",viewBox:"0 0 17 21","aria-labelledby":n},r),e?c.createElement("title",{id:n},e):null,w||(w=c.createElement("path",{fill:"#1A1A1A",d:"M5.3 14.5h6c.6 0 1 .4 1 1s-.4 1-1 1h-6c-.6 0-1-.4-1-1 0-.5.4-1 1-1m0-4h6c.6 0 1 .4 1 1s-.4 1-1 1h-6c-.6 0-1-.4-1-1 0-.5.4-1 1-1m5-10h-8c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-12zm4 18h-12v-16h7v3c0 1.1.9 2 2 2h3z"})))};var y;function k(){return k=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},k.apply(this,arguments)}const M=t=>{let{title:e,titleId:n,...r}=t;return c.createElement("svg",k({xmlns:"http://www.w3.org/2000/svg",width:24,height:23,fill:"none",viewBox:"0 0 24 23","aria-labelledby":n},r),e?c.createElement("title",{id:n},e):null,y||(y=c.createElement("path",{fill:"#fff",d:"M18.203 7.2h-17c-.6 0-1 .4-1 1v9c0 2.8 2.2 5 5 5h8c2.8 0 5-2.2 5-5 2.8 0 5-2.2 5-5s-2.3-5-5-5m-2 10c0 1.7-1.3 3-3 3h-8c-1.7 0-3-1.3-3-3v-8h14zm2-2v-6c1.7 0 3 1.3 3 3 0 1.6-1.4 3-3 3M5.203 5.2c.6 0 1-.4 1-1v-3c0-.6-.4-1-1-1s-1 .4-1 1v3c0 .5.4 1 1 1M9.203 5.2c.6 0 1-.4 1-1v-3c0-.6-.4-1-1-1s-1 .4-1 1v3c0 .5.4 1 1 1M13.203 5.2c.6 0 1-.4 1-1v-3c0-.6-.4-1-1-1s-1 .4-1 1v3c0 .5.4 1 1 1"})))};var O;function C(){return C=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},C.apply(this,arguments)}const E=t=>{let{title:e,titleId:n,...r}=t;return c.createElement("svg",C({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",viewBox:"0 0 24 24","aria-labelledby":n},r),e?c.createElement("title",{id:n},e):null,O||(O=c.createElement("path",{stroke:"#fff",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10M12 16v-4M12 8h.01"})))};var T;function B(){return B=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},B.apply(this,arguments)}const I=t=>{let{title:e,titleId:n,...r}=t;return c.createElement("svg",B({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",viewBox:"0 0 24 24","aria-labelledby":n},r),e?c.createElement("title",{id:n},e):null,T||(T=c.createElement("path",{stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0M12 9v4M12 17h.01"})))};var S=n(5893);const A={tip:{color1:"#336667",color2:"#00B067",icon:(0,S.jsx)(b,{}),darkMode:!0},reading:{color1:"#F46800",color2:"#F24CF4",icon:(0,S.jsx)(i,{}),darkMode:!1},info:{color1:"#336667",color2:"#00B067",icon:(0,S.jsx)(E,{}),darkMode:!0},warn:{color1:"#00B067",color2:"#FFD303",icon:(0,S.jsx)(I,{}),darkMode:!1},warning:{color1:"#00B067",color2:"#FFD303",icon:(0,S.jsx)(I,{}),darkMode:!1},synopsis:{color1:"#1c1c1c",color2:"#1c1c1c",icon:null,darkMode:!0},prerequisite:{color1:"lightgray",color2:"lightgray",icon:(0,S.jsx)(l,{}),darkMode:!1},learning:{color1:"#6836D0",color2:"#05BDFC",icon:(0,S.jsx)(u,{}),darkMode:!0},"best-practice":{color1:"#6836D0",color2:"#6836D0",icon:(0,S.jsx)(m,{}),darkMode:!0},remember:{color1:"#6D0000",color2:"#F66800",icon:(0,S.jsx)(b,{}),darkMode:!0},note:{color1:"#F69900",color2:"#FFCE15",icon:(0,S.jsx)(j,{}),darkMode:!1},docs:{color1:"#6836D0",color2:"#F44CF6",icon:(0,S.jsx)(M,{}),darkMode:!0}},F=t=>{let{color1:e,color2:n}=t;return{background:`linear-gradient(78.06deg, ${e} 1.14%, ${n} 98.88%)`,border:0,borderRadius:16,padding:"0 30px",display:"flex",width:"100%",justifyContent:"start",marginBottom:20,fontSize:18,flexDirection:"column"}};const z=function(t){let{type:e,title:n,children:r}=t;const o=A[e]||A.info,i={backgroundColor:"var(--docusaurus-highlighted-code-line-bg)"},s={alignSelf:"center",filter:o.darkMode?"brightness(0) invert(1)":"brightness(0)"},a={marginTop:"10px",marginLeft:"10px",color:o.darkMode?"#e6e6e6":"black"},l={color:o.darkMode?"#e6e6e6":"black",marginBottom:"10px"},d=c.Children.map(r,(t=>"code"===t.type?c.cloneElement(t,{style:i}):t));return(0,S.jsxs)("div",{style:F(o),className:"highlightBox",id:e,children:[(0,S.jsx)("style",{children:`\n          #${e} a {\n            color: ${o.darkMode?"#85c1e9":"blue"} !important;\n          }\n        `}),(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"4px",marginTop:"10px"},children:[(0,S.jsx)("div",{style:s,children:o.icon}),(0,S.jsx)("h3",{style:a,children:n})]}),(0,S.jsx)("div",{style:l,children:d})]})}},1151:(t,e,n)=>{n.d(e,{Z:()=>s,a:()=>i});var r=n(7294);const c={},o=r.createContext(c);function i(t){const e=r.useContext(o);return r.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function s(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(c):t.components||c:i(t.components),r.createElement(o.Provider,{value:e},t.children)}}}]);